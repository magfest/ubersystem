{% extends 'static_views/static_base.html' %}
{% import 'art_show_common/print_macros.html' as print_macros with context %}

{% set no_print = True %}
{% include 'art_show_common/print.html' with context %}
{% import 'macros.html' as macros with context %}

{% block page %}
<h3 align="center">Pieces by Status Report -- {{ now_localized()|datetime("%m/%d/%Y, %-I:%M%p") }}</h3>
<div class="d-print-none card-body">
<strong>{{ message }}</strong>
<form role="form" method="get" action="pieces_by_status">
  <div class="row g-3 mb-3">
    <div class="col-sm">
      <div class="form-text">Pieces in Status of</div>
      {{ macros.checkgroup_opts('yes_status', c.ART_PIECE_STATUS_OPTS, defaults=[] if not yes_status else yes_status|join(',')) }}
    </div>
    <div class="col-sm">
      <div class="form-text">Pieces NOT in Status of</div>
      {{ macros.checkgroup_opts('no_status', c.ART_PIECE_STATUS_OPTS, defaults=[] if not no_status else no_status|join(',')) }}
    </div>
  </div>
  <div class="d-flex gap-2">
    <div>
      <button type="submit" class="btn btn-primary">Load Pieces by Status</button>
    </div>
    <div><a href="javascript:window.print()" class="btn btn-success">Print Pieces</a></div>
  </div>
</form>
</div>

<p style="margin: 20px; width: calc(100% - 40px);">
  <strong>Total</strong>: {{ num_pieces }} pieces{% if yes_status or no_status %} that
  {% if yes_status %}ARE {{ yes_status_labels }}{% if no_status %} and {% endif %}{% endif %}
  {% if no_status %}ARE NOT {{ no_status_labels }}{% endif %}
  {% endif %}
</p>
<div class="card-body p-0 m-0">
{% for app in apps %}
<table class="table table-bordered" style="margin: 20px; width: calc(100% - 40px);">
  <tr>
    <td><strong>Artist ID</strong></td><td colspan="3">{{ app.artist_id }}{% if app.artist_id_ad %} ({{ app.artist_id_ad }}){% endif %}</td>
  </tr>
  <tr>
    <td><strong>Artist Name</strong></td><td colspan="3">{{ app.display_name }}{% if app.banner_name_ad %} ({{ app.mature_display_name }}){% endif %}</td>
  </tr>
  <tr>
    <th>Piece ID</th>
    <th>Piece Name</th>
    <th>Status</th>
    <th>Location</th>
  </tr>
  {% for piece in app.art_show_pieces %}
  {% if (not yes_status or piece.status|string in yes_status|join(',')) and (not no_status or piece.status|string not in no_status|join(',')) %}
  <tr>
    <td>{{ piece.artist_and_piece_id }}</td>
    <td>{{ piece.name|wordwrap(25, wrapstring="<br />"|safe) }}</td>
    <td>{{ piece.status_label }}</td>
    <td>{{ piece.gallery_label }}</td>
  </tr>
  {% endif %}
  {% endfor %}
</table>
{% endfor %}
</div>
{% endblock %}