{% extends "base.html" %}{% set admin_area=True %}
{% import 'forms/macros.html' as form_macros with context %}
{% block title %}Job Form{% endblock %}
{% block content %}
{% include "shifts_admin/job_menu.html" %}

<h2>
  {%- if job.is_new -%}
    <i class="fa fa-plus"></i> New Job
  {%- else -%}
    <i class="fa fa-cog"></i> Edit {{ job.name }}
  {%- endif -%}
</h2>

<script type="text/javascript">
    function blank() {
        var defaults = {
            name: "",
            description: "",
            duration: 1,
            slots: 1,
            weight: 1.0
        };
        $.each(defaults, function(name, value){
            $("[name=" + name + "]").val(value);
        });
        $("input[type=checkbox]").prop("checked", false);
    }
    {% if not job.is_new %}
      $(function() {
          $("form[action='delete']").submit(function(event){
              var formToSubmit = this;
              event.preventDefault();
              bootbox.confirm({
                  message: "This will permanently delete this shift. Are you sure?",
                  buttons: {
                      confirm: {
                          label: 'Delete Shift',
                          className: 'btn-danger'
                      },
                      cancel: {
                          label: 'Nevermind',
                          className: 'btn-outline-secondary'
                      }
                  },
                  callback: function (result) {
                      if(result) {
                          formToSubmit.submit();
                      }
                  }
              });
          });
      });
    {% endif %}
</script>

{% if defaults %}
<p>
  <i>
    Note: To help you enter the same job at multiple times, this form has
    been filled in using the values of the last shift you created in this
    department.<br/>
    <a href="#" onClick="blank(); return false;">Click here</a> to undo
    these defaults and start with a blank form.
  </i>
  </p>
{% endif %}

<div class="card card-body">
  {{ form_macros.form_validation('job-form', 'validate_job') }}
  <form novalidate method="post" action="form" id="job-form">
    <input type="hidden" name="id" value="{{ job.db_id }}" />
    <input type="hidden" name="from_schedule" value="{{ from_schedule }}" />
    <input type="hidden" name="department_id" value="{{ department.id }}" />
    
    {{ csrf_token() }}

    {% include 'forms/department/job_info.html' with context %}
  </form>

  <div class="d-flex gap-2 justify-content-between">
    <button type="submit" form="job-form" class="btn btn-primary">Save Job</button>
    {% if not job.is_new %}
      <form method="post" action="delete" class="form-delete">
        {{ csrf_token() }}
        <input type="hidden" name="id" value="{{ job.id }}" />
        <div class="form-group">
          <div class="col-sm-9 col-sm-offset-3">
            <input type="submit" class="btn btn-danger" value="Delete Job" />
          </div>
        </div>
      </form>
    {% endif %}
  </div>
</div>

{% endblock %}

{% block page_scripts %}{% endblock %}

